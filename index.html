<html>
	<head>
	  <meta charset="UTF-8">
	  <title> Menu </title>
	</head>
	<body>
		<h1>Metadata Ingest v 0.1</h1>
		<div >
			<form id="data-form" action="#">
				<input type="text" placeholder="Productor" name="producer" minlength="3" required >
				<input type="text" placeholder="ProducciÃ³n" name="production" minlength="3" required>
				<!-- <input type="text" placeholder="Personajes"> -->
				
				<div id="contents"></div>
				<input type="submit" value="Ingestar">
			</form>
			
		</div>
		
		
		<script src="./js/jquery-3.1.1.js"></script>
		<script src="./js/jquery.validate.js"></script>
		<script>
		$.validator.setDefaults({
			submitHandler: function() {
				alert("submitted!");
			}
		});
		$("#data-form").validate();



		// Load native UI library
		var gui = require('nw.gui');

		// Create an empty menu
		// var menu = new gui.Menu();

		// // Add some items with label
		// menu.append(new gui.MenuItem({ label: 'Item A',
		// 							   click:function(){
		// 							   	console.log("Item A");
		// 							   	gui.Shell.openExternal('https://github.com/rogerwang/node-web +kit');
		// 							   }

		//  }));
		// menu.append(new gui.MenuItem({ label: 'Item B' }));
		// menu.append(new gui.MenuItem({ type: 'separator' }));
		// menu.append(new gui.MenuItem({ label: 'Item C' }));

		// // Remove one item
		// menu.removeAt(1);

		// // Iterate menu's items
		// for (var i = 0; i < menu.items.length; ++i) {
		//   console.log(menu.items[i]);
		// }

		// // Add a item and bind a callback to item
		// menu.append(new gui.MenuItem({
		// label: 'Click Me',
		// click: function() {
		//   // Create element in html body
		//   var element = document.createElement('div');
		//   element.appendChild(document.createTextNode('Clicked OK'));
		//   document.body.appendChild(element);
		// }
		// }));

		// Popup as context menu
		// document.body.addEventListener('contextmenu', function(ev) { 
		//   ev.preventDefault();
		//   // Popup at place you click
		//   menu.popup(ev.x, ev.y);
		//   return false;
		// }, false);

		// Get the current window
		// var win = gui.Window.get();

		// // Create a menubar for window menu
		// var menubar = new gui.Menu({ type: 'menubar' });

		// // Create a menuitem
		// var sub1 = new gui.Menu();


		// sub1.append(new gui.MenuItem({
		// label: 'Test1',
		// click: function() {
		//   var element = document.createElement('div');
		//   element.appendChild(document.createTextNode('Test 1'));
		//   document.body.appendChild(element);
		// }
		// }));

		// // You can have submenu!
		// menubar.append(new gui.MenuItem({ label: 'Sub1', submenu: sub1}));

		// //assign the menubar to window menu
		// win.menu = menubar;

		// add a click event to an existing menuItem
		// menu.items[1].click = function() { 
		//     console.log("CLICK"); 
		// };



		var path = require("path");
		var fs = require('fs');
		console.log("PATH: "+path.dirname(process.execPath));
		console.log("CWD: "+process.cwd());

		var path_a=path.dirname(process.execPath);

		const { exec } = require('child_process');
		exec(path_a+"\\exes\\pp.bat", (error, stdout, stderr) => {
		  if (error) {
		    console.error(`exec error: ${error}`);
		    return;
		  }
		  console.log(`stdout: ${stdout}`);
		  console.log(`stderr: ${stderr}`);

		});

		var path_f=path_a+"\\files\\";
		var files = [];
		fs.readdir(path_f, function(err, items) {
		    console.log(items);
		 
		    for (var i=0; i<items.length; i++) {
		        console.log(path_a+"\\files\\"+items[i]);
		        // var da = fs.stat(path_a+"\\files\\"+items[i], function(err, stats,ite = items[i] ){
		        // 	console.log(`${ite} C date: ${stats.birthtime}`);
		        // 	console.log(`M date: ${stats.mtime}`);
		        // 	return stats.birthtime;
		        // });
		        // console.log("DA: "+da);
		        


		        stats = fs.lstatSync(path_a+"\\files\\"+items[i]);
		        // console.log(items[i] + "\n    Created: " + stats['birthtime'].toString());

		        // console.log("    Modified: " + stats['mtime'].toString());
		        // console.log("    Size: " + stats['size'].toString());
		        var obj_info = {"file_name":items[i],"created":stats['birthtime'].toISOString(),"modified":stats['mtime'].toString(),"size":stats['size'].toString()};
		        // console.log(items[i]);
		        // console.log(obj_info);
		        files.push(obj_info);
		        cont = $("#contents").html();
		        $("#contents").html(cont + "<h3>"+obj_info["file_name"]+"</h3> <i> <span>Creado: </span>"+obj_info["created"]+"</i><input type=\"text\" id=\"characters_"+ i.toString() +"\" name=\"characters_"+ i.toString() +"\" placeholder=\"Personajes\" minlength=\"3\" required>");

		    }

		    console.log(files);
		});

		fs.stat(path_a+"\\files\\f3.txt", function(err, stats){
			let seconds = (new Date().getTime() - stats.mtime) / 1000;
    		console.log(`File modified ${seconds} ago`);
    		// console.log(`Modified date: ${stats.mtime}`);
		});
		
		</script>  
	</body>
</html>